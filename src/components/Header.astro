---
import { getCollection, type CollectionEntry } from "astro:content";
import logoSvg from "../assets/misc_images/blutattoo-trimmed.svg?raw"; // raw markup string
const logoColor = "text-orange-100 md:hover:text-indigo-400";

// Load & order artists
let artists = (await getCollection("artists")) as CollectionEntry<"artists">[];
artists = artists.sort((a, b) =>
  (a.data.order ?? 999) - (b.data.order ?? 999) || a.data.title.localeCompare(b.data.title)
);

// Active link helper
const currentPath = Astro.url.pathname;
const isActive = (href: string) =>
  currentPath === href || (href !== "/" && currentPath.startsWith(href));
---

<!-- Top LOGO (desktop only, not sticky) -->
<div class="hidden md:block bg-black/80">
  <div class="mx-auto max-w-6xl px-4">
    <a href="/" class={`block py-6 md:py-8 ${logoColor}`} aria-label="BluTattoo Studio">
      <div
        class="w-fit mx-auto h-20 md:h-50
               [&_svg]:block [&_svg]:h-full [&_svg]:w-auto
               [&_path]:fill-current [&_g]:fill-current"
        set:html={logoSvg}
      />
    </a>
  </div>
</div>

<!-- Sticky NAV (desktop) -->
<div class="hidden md:block sticky top-0 z-50 border-b bg-black/80 text-orange-100 backdrop-blur">
  <nav class="mx-auto max-w-6xl px-4">
    <ul class="flex items-center justify-center gap-8 py-3">
      <li>
        <a
          href="/"
          data-astro-prefetch="hover"
          class={`hover:underline focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 ${
            isActive("/") ? "font-semibold underline text-indigo-400" : ""
          }`}
        >
          HOME
        </a>
      </li>

      <li class="relative group">
        <details class="relative">
          <summary
            class={`list-none cursor-pointer flex items-center gap-1 hover:underline focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 ${
              isActive("/artists") ? "font-semibold underline text-indigo-400" : ""
            }`}
          >
            ARTISTS
            <svg width="16" height="16" color="red" viewBox="0 0 24 24" aria-hidden="true">  <style>
              path { fill: oklch(95.4% 0.038 75.164); }
            </style><path d="M7 10l5 5 5-5H7z" /></svg>
          </summary>
          <ul
            role="menu"
            class="absolute left-1/2 -translate-x-1/2 mt-2 w-64 border bg-black/95 text-orange-100 backdrop-blur p-2 shadow-lg z-20"
          >
            {artists.map((entry) => (
              <li role="none">
                <a
                  role="menuitem"
                  href={`/artists/${entry.id}/`}
                  class="block px-3 py-2 hover:outline-1 hover:outline-orange-100"
                  data-astro-prefetch="hover"
                >
                  {entry.data.title}
                </a>
              </li>
            ))}
          </ul>
        </details>
      </li>

      <li>
        <a
          href="/faq"
          data-astro-prefetch="hover"
          class={`hover:underline focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 ${
            isActive("/faq") ? "font-semibold underline text-indigo-400" : ""
          }`}
        >
          FAQ
        </a>
      </li>

      <li>
        <a
          href="/aftercare"
          data-astro-prefetch="hover"
          class={`hover:underline focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 ${
            isActive("/aftercare") ? "font-semibold underline text-indigo-400" : ""
          }`}
        >
          AFTERCARE
        </a>
      </li>
    </ul>
  </nav>
</div>

<!-- Mobile: single sticky bar (logo + menu button) -->
<header class="md:hidden sticky top-0 z-50 border-b bg-black/80 text-orange-100 backdrop-blur">
  <div class="mx-auto max-w-6xl px-4 py-3 flex items-center justify-between">
    <a href="/" class={`flex items-center gap-2 ${logoColor}`} aria-label="BluTattoo Studio">
      <div
        class="h-15 w-auto
               [&_svg]:h-full [&_svg]:w-auto
               [&_path]:fill-current [&_g]:fill-current"
        set:html={logoSvg}
      />
      <span class="sr-only">BluTattoo Studio</span>
    </a>

    <details>
      <summary class="cursor-pointer border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
        Menu
      </summary>
      <nav class="mt-2 flex flex-col gap-2 bg-black/80 p-2">
        <a href="/" class="px-2 py-2 hover:bg-white/10">Home</a>

        <!-- <details>
          <summary class="px-2 py-2 rounded hover:bg-white/10 cursor-pointer focus:outline-none">
            Artists
          </summary>
          <ul class="ml-3 mt-1 flex flex-col">
            {artists.map((entry) => (
              <li>
                <a class="px-2 py-2 rounded hover:bg-white/10" href={`/artists/${entry.id}/`}>
                  {entry.data.title}
                </a>
              </li>
            ))}
          </ul>
        </details> -->

        <details>
          <summary class="px-2 py-2 hover:bg-white/10 cursor-pointer focus:outline-none">
            Artists
          </summary>
        
          <ul
            class="ml-3 mt-2 flex max-h-[60vh] flex-col gap-1 overflow-auto pr-1
                   divide-y divide-white/10"
          >
            {artists.map((entry) => (
              <li>
                <a
                  href={`/artists/${entry.id}/`}
                  class="block px-3 py-3 text-base hover:bg-white/10 focus:bg-white/10"
                  data-astro-prefetch="hover"
                >
                  {entry.data.title}
                </a>
              </li>
            ))}
          </ul>
        </details>
        

        <a href="/faq" class="px-2 py-2 hover:bg-white/10">FAQ</a>
        <a href="/aftercare" class="px-2 py-2 hover:bg-white/10">Aftercare</a>
      </nav>
    </details>
  </div>
</header>

<style>
  summary { list-style: none; }
  summary::-webkit-details-marker { display: none; }

  @media (min-width: 768px) {
    /* open-on-hover convenience for desktop dropdown */
    details > ul { display: none; }
    details[open] > ul { display: block; }
    details.group:hover > ul { display: block; }
  }
</style>

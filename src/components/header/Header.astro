---
import { getCollection, type CollectionEntry, getEntry } from "astro:content";
import branding from "../../content/branding.json";
import BlobRow from "../../components/decor/BlobRow copy.astro";
import PromoBarLoader from "./PromoBarLoader.astro";
import MobileMenu from "./MobileMenu.astro";
import DesktopMenu from "./DesktopMenu.astro";
import HeroBackdrop from "./HeroBackdrop.astro";
import DesktopTopLogo from "./DesktopTopLogo.astro";
import type { MenuItem } from "./types";

const { variant = "default", defaults, site } = Astro.props;

/**
 * ARTISTS
 */
// Load & order artists todo: see if we can't refactor this into types.ts somehow
let artists = (await getCollection("artists")) as CollectionEntry<"artists">[];
artists = artists.sort(
  (a, b) =>
    (a.data.order ?? 999) - (b.data.order ?? 999) ||
    a.data.title.localeCompare(b.data.title),
);

const artistLinks = artists.map((entry) => ({
  type: "link" as const,
  label: entry.data.title,
  href: `/artists/${entry.id}/`,
  prefetch: true,
}));

const menuItems: MenuItem[] = [
  { type: "link", label: "Home", href: "/" },
  { type: "submenu", label: "Artists", items: artistLinks },
  { type: "link", label: "Piercing", href: "/piercing" },
  { type: "link", label: "Events", href: "/events" },
  { type: "link", label: "Aftercare", href: "/aftercare" },
  { type: "link", label: "FAQ", href: "/faq" },
  { type: "link", label: "Contact Us", href: "/contact" },
];

const siteName = site?.data?.siteName ?? defaults.siteName;
const logo_dark = branding?.logo_dark ?? defaults.siteLogo;
const logo_light = branding?.logo_light ?? defaults.siteLogo;
const heroVideo = branding?.hero?.video;
---

<!-- Promo announcement bar -->
<PromoBarLoader fallbackHref="/events" />

{
  variant === "home" ? (
    <HeroBackdrop logo_dark={logo_dark} siteName={siteName} video={heroVideo} />
  ) : (
    <DesktopTopLogo logo_dark={logo_dark} siteName={siteName} />
  )
}

<!-- desktop nav -->
<DesktopMenu menuItems={menuItems} currentPath={Astro.url.pathname} />

<!-- mobile nav + logo -->
<MobileMenu
  menuItems={menuItems}
  logo_light={logo_light}
  variant={variant}
  siteName={siteName}
/>

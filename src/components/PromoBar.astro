---
const {
  id = "promo-bar",
  height = 40, // px number
  storageKey = "bt_promo_dismissed",
  message = "Now booking March!",
  href = "/booking",
} = Astro.props;

const h = `${height}px`;
---

<!-- Spacer: keeps layout from sliding under the fixed bar -->
<div id={`${id}-spacer`} style={`height:${h};`} aria-hidden="true"></div>

<aside
  id={id}
  class="fixed top-0 left-0 w-full z-[80]"
  style={`height:${h};`}
  role="region"
  aria-label="Announcement"
>
  <!-- todo: make this accept a chosen color or css gradient and if that fails, fall back to a default gradient/ color scheme -->
  <div
    class="h-full flex items-center justify-center gap-3 px-4 text-white text-sm sm:text-base md:text-2xl"
    style="
      background: linear-gradient(90deg,
        rgba(2,0,36,1) 0%,
        rgba(9,9,121,1) 35%,
        rgb(0, 94, 255) 100%
      );
    "
  >
    <!-- <style>
  .promo-outline{
    font-size: 18px;
    font-weight: 800;
    color: black;
    -webkit-text-stroke: 3px white;
    paint-order: stroke fill; /* not everywhere, but helps where supported */
  }
</style> -->
    <a
      class="promo-outline flex items-center justify-center w-full h-full text-center"
      href={href}
    >
      {message}
    </a>
    <button
      type="button"
      class="ml-auto px-2 py-1 leading-none cursor-pointer"
      aria-label="Dismiss announcement"
      data-dismiss
    >
      âœ•
    </button>
  </div>

  <script is:inline define:vars={{ storageKey, id }}>
    (() => {
      const banner = document.getElementById(id);
      const spacer = document.getElementById(`${id}-spacer`);
      if (!banner || !spacer) return;

      const hide = () => {
        banner.style.display = "none";
        spacer.style.display = "none";
        document.documentElement.style.removeProperty("--announcement-h");
      };

      // if dismissed before, hide immediately
      // try {
      //   // if (localStorage.getItem(storageKey) === "1") hide();
      //   // else document.documentElement.style.setProperty("--announcement-h", spacer.style.height);
      //   // always setting it for now to test
      //   document.documentElement.style.setProperty(
      //     "--announcement-h",
      //     spacer.style.height,
      //   );
      // } catch {}

      try {
        if (localStorage.getItem(storageKey) === "1") hide();
        else
          document.documentElement.style.setProperty(
            "--announcement-h",
            spacer.style.height,
          );
      } catch {
        document.documentElement.style.setProperty(
          "--announcement-h",
          spacer.style.height,
        );
      }

      banner.querySelector("[data-dismiss]")?.addEventListener("click", () => {
        try {
          localStorage.setItem(storageKey, "1");
        } catch {}
        hide();
      });
    })();
  </script>
</aside>
